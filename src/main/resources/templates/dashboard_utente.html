<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<link rel="stylesheet" th:href="@{/css/dashboard_utente.css}">

<head th:replace="fragments/generic_fragments :: head('Dashboard - PawPal')"></head>

<body>

    <div th:replace="fragments/generic_fragments :: navbar(dashboard)"></div>
    <div th:replace="fragments/dashboard_fragments :: dashboard-sidebar"></div>

    <div th:replace="fragments/generic_fragments :: backend_message"></div>


    <main>

        <div id="modifica_dati" class="showable container-fluid flex-column" style="display: none;">

            <section>

                <div th:replace="fragments/generic_fragments :: backend_message"></div>

                <h2>Modifica dati</h2>

                <div class="row">

                    <form th:action="@{/dash/profilo/modifica_dati}" method="post" style="display: contents;">

                        <div class="col-12">

                            <fieldset>
                                <legend>Informazioni Personali</legend>

                                <div>
                                    <label class="form-label" for="nome">Nome</label>
                                    <input class="form-control" id="nome" name="nome" type="text"
                                        th:value="${#strings.defaultString(user.nome,'')}" />
                                </div>

                                <div>
                                    <label class="form-label" for="cognome">Cognome</label>
                                    <input class="form-control" id="cognome" name="cognome" type="text"
                                        th:value="${#strings.defaultString(user.cognome,'')}" />
                                </div>

                                <div>
                                    <label class="form-label" for="telefono">Telefono</label>
                                    <input class="form-control" id="telefono" name="telefono" type="tel"
                                        th:value="${#strings.defaultString(user.telefono,'')}" maxlength="10" />
                                </div>

                                <div>
                                    <label class="form-label" for="codiceFiscale">Codice fiscale</label>
                                    <input class="form-control" id="codiceFiscale" name="codiceFiscale" type="text"
                                        th:value="${#strings.defaultString(user.codiceFiscale,'')}" maxlength="16" />
                                </div>
                            </fieldset>

                        </div>

                        <div class="col-12"
                            th:if="${#authentication.authorities.![authority].contains('ROLE_VETERINARIO')}">

                            <fieldset>
                                <legend>Informazioni professionali</legend>

                                <div>
                                    <label class="form-label" for="indirizzoStudio">Indirizzo</label>
                                    <input class="form-control" id="indirizzoStudio" name="indirizzoStudio" type="text"
                                        th:value="${#strings.defaultString(user.indirizzoStudio,'')}" />
                                </div>

                                <div>
                                    <label class="form-label" for="specializzazione">Specializzazione</label>
                                    <input class="form-control" id="specializzazione" name="specializzazione"
                                        type="text" th:value="${#strings.defaultString(user.specializzazione,'')}" />
                                </div>

                                <!-- CERCARE LE SPECIE PER VETERINARIO -->
                                <div>
                                    <label class="form-label">Specie trattate:</label>
                                    <div class="btn-group" role="group" aria-label="specie trattate dal veterinario">
                                        <div id="lista_specie" th:each="specie : ${lista_specie}" style="display: contents;">
                                            <input
                                                type="checkbox"
                                                class="btn-check"
                                                name="specie"
                                                th:value="${specie.id}"
                                                th:checked="${#lists.contains(lista_specie_selezionate, specie)}"
                                                th:id="'specie_' + ${specie.id}"
                                            />
                                            <label class="btn btn-outline-primary" th:for="'specie_' + ${specie.id}">
                                                <span th:text="${specie.nomeSpecie}">Nome Specie</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <!-- CERCARE LE PRESTAZIONI PER VETERINARIO -->
                                <div>
                                    <label class="form-label">Prestazioni offerte:</label>
                                    <div class="btn-group" role="group" aria-label="prestazioni offerte dal veterinario">
                                        <div id="lista_prestazioni" th:each="prestazione : ${lista_prestazioni}" style="display: contents;">
                                            <input
                                                type="checkbox"
                                                class="btn-check"
                                                name="prestazioni"
                                                th:value="${prestazione.id}"
                                                th:checked="${#lists.contains(lista_prestazioni_selezionate, prestazione)}"
                                                th:id="'prestazione_' + ${prestazione.id}" />
                                            <label class="btn btn-outline-primary" th:for="'prestazione_' + ${prestazione.id}">
                                                <span th:text="${prestazione.descrizione}">Nome Prestazione</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <label class="form-label" for="iscrizione_albo">Numero di iscrizione
                                        all&#39;albo:</label>
                                    <input class="form-control" type="text" id="iscrizione_albo" name="iscrizioneAlbo"
                                        th:value="${#strings.defaultString(user.iscrizioneAlbo,'')}" maxlength="10">
                                </div>

                                <div>
                                    <label class="form-label"
                                        for="disponibilita_veterinario">Disponibilit&#224;:</label>
                                    <input class="form-control" type="text" id="disponibilita_veterinario"
                                        name="disponibilita"
                                        th:value="${#strings.defaultString(user.disponibilita,'')}">
                                </div>

                                <div>
                                    <label class="form-label" for="descrizione">Descrizione </label>
                                    <textarea class="form-control" id="descrizione" name="descrizione"
                                        th:text="${#strings.defaultString(user.descrizione,'')}"
                                        placeholder="Descrivi chi sei e di cosa ti occupi" maxlength="140"></textarea>
                                </div>

                            </fieldset>

                        </div>

                        <div class="form-actions">
                            <button class="btn btn-secondary" type="submit">Salva modifiche</button>
                            <button class="btn btn-secondary" type="reset">Annulla</button>
                        </div>

                    </form>

                </div>

            </section>

            <section>

                <!-- AGGIUNGERE ELIMINAZIONE ACCOUNT -->

            </section>

        </div>

        <div id="appuntamenti" class="showable container-fluid flex-column" style="display: none;">

            <section>

                <h2>I tuoi Appuntamenti</h2>

                <form th:action="@{/dash/appuntamenti}" method="get">
                    <input type="date" name="data" placeholder="Filtra per data">
                    <input type="text" name="veterinario" placeholder="Cerca per veterinario">
                    <button type="submit" class="btn btn-primary">Filtra</button>
                </form>

                <table class="table-appuntamenti">
                    <thead>
                        <tr>
                            <th th:text="${#authentication.authorities.![authority].contains('ROLE_VETERINARIO')} ? 'Cliente' : 'Veterinario'"></th>
                            <th th:if="${#authentication.authorities.![authority].contains('ROLE_CLIENTE')}">
                                Indirizzo
                            </th>
                            <th>Telefono</th>
                            <th>Data e Ora</th>
                            <th>Note</th>
                        </tr>
                    </thead>

                    <tbody>
                        <tr th:each="appuntamento : ${lista_appuntamenti}">
                            <td th:text="${appuntamento.nomeUtente + ' ' + appuntamento.cognomeUtente}"></td>
                            <td 
                                th:if="${#authentication.authorities.![authority].contains('ROLE_CLIENTE')}"
                                th:text="${appuntamento.indirizzoUtente}"
                            ></td>
                            <td th:text="${appuntamento.telefonoUtente}"></td>
                            <td th:text="${#temporals.format(appuntamento.dataOraAppuntamento, 'dd/MM/yyyy HH:mm')}"></td>
                            <td th:text="${appuntamento.noteAppuntamento}"></td>

                            <td>
                                <div>
                                    <form th:action="@{/dash/appuntamenti/modifica_appuntamento}" method="post">
                                        <button type="submit" class="btn btn-primary">Modifica</button>
                                    </form>

                                    <form th:action="@{/dash/appuntamenti/elimina_appuntamento}" method="post">
                                        <button type="submit" class="btn btn-danger">Elimina</button>
                                    </form>
                                </div>
                            </td>
                        </tr>

                    </tbody>

                </table>

                <div th:if="${#lists.isEmpty(lista_appuntamenti)}" class="no-data">
                    <p>Nessun appuntamento trovato.</p>
                </div>

            </section>

        </div>

        <div id="recensioni" class="showable container-fluid flex-column" style="display: none;">
            
            <section class="recensioni-section">

                <h2
                    th:text="${#authentication.authorities.![authority].contains('ROLE_CLIENTE')} ?
                             'Le tue recensioni' : 'Recensioni ricevute'"
                >
                    Recensioni
                </h2>

                <div th:if="${#lists.isEmpty(lista_recensioni)}">
                    <p 
                        th:text="${#authentication.authorities.![authority].contains('ROLE_CLIENTE')} ?
                                 'Nessuna recensione inviata' : 'Nessuna recensione ricevuta'"
                    >
                        Nessuna recensione.
                    </p>
                </div>

                <ul th:if="${!#lists.isEmpty(lista_recensioni)}" class="recensioni-list">
                    <li th:each="recensione : ${lista_recensioni}" class="recensione-item">
                        <div class="rec-header">
                            <strong class="rec-vet">
                                <span 
                                    th:text="${(#authentication.authorities.![authority].contains('ROLE_CLIENTE')) ?
                                             recensione.nomeUtente + ' ' + recensione.cognomeUtente : recensione.usernameUtente}"
                                ></span>
                            </strong>
                            <span
                                class="rec-date"
                                th:text="${#temporals.format(recensione.dataRecensione, 'dd/MM/yyyy')}"
                            ></span>
                            <span class="rec-rating" th:text="${recensione.votoRecensione} + ' / 5'"></span>
                        </div>

                        <p class="rec-text" th:text="${recensione.commentoRecensione}"></p>

                        <div class="rec-actions" th:if="${(#authentication.authorities.![authority].contains('ROLE_CLIENTE'))}">
                            <form 
                                th:action="@{/dash/recensioni/elimina_recensione}"
                                method="post"
                                style="display:inline"
                            >
                                <input type="hidden" name="id" th:value="${recensione.idRecensione}" />
                                <button type="submit" class="btn btn-danger">Elimina</button>
                            </form>
                        </div>
                    </li>
                </ul>

            </section>

        </div>

        <div id="linee_guida" class="showable container-fluid flex-column" style="display: none;">
            <section>
                <h1>Linee Guida per Veterinari</h1>

                <p>Qui puoi consultare le linee guida ufficiali per la gestione dei pazienti e le best practices da
                    seguire.</p>

                <div>
                    <ul>
                        <li th:each="guida : ${lineeGuida}">
                            <h3 th:text="${guida.titolo}">Titolo linea guida</h3>
                            <p th:text="${guida.descrizione}">Descrizione della linea guida...</p>
                            <a th:href="@{${guida.link}}" target="_blank" class="btn">Leggi completo</a>
                        </li>
                    </ul>
                </div>

                <div th:if="${#lists.isEmpty(lineeGuida)}">
                    <p>Nessuna linea guida disponibile al momento.</p>
                </div>
            </section>
        </div>

    </main>

    <div th:replace="fragments/dashboard_fragments :: modifica_conto(email, 'false')"></div>
    <div th:replace="fragments/dashboard_fragments :: modifica_conto(username, 'false')"></div>
    <div th:replace="fragments/dashboard_fragments :: modifica_conto(password, 'true')"></div>

    <script th:src="@{/js/dashboard.js}" defer></script>
    <div th:replace="fragments/generic_fragments :: show_views_scripts"></div>

</body>

</html>