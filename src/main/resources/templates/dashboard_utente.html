<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments :: head('Appuntamenti - PawPal')"></head>

<body>
<header th:replace="fragments :: dashboard-header('Appuntamenti')"></header>

<aside th:replace="fragments :: sidebar"></aside>

<main class="main-content">
    <section class="dashboard-section">
        <h2>I tuoi Appuntamenti</h2>

        
        <form class="filter-form" th:action="@{/dash/appuntamenti}" method="get">
            <input type="date" name="data" placeholder="Filtra per data">
            <input type="text" name="veterinario" placeholder="Cerca per veterinario">
            <button type="submit" class="btn">Filtra</button>
        </form>

        
        <table class="table-appuntamenti">
            <thead>
                <tr>
                    <th>Data</th>
                    <th>Ora</th>
                    <th th:text="${#strings.equalsIgnoreCase(user.role,'veterinario')} ? 'Cliente' : 'Veterinario'"></th>
                    <th>Specie</th>
                    <th>Motivo</th>
                    <th>Stato</th>
                    <th>Azioni</th>
                </tr>
            </thead>

            <tbody>
                <tr th:each="app : ${appuntamenti}">
                    <td th:text="${app.data}"></td>
                    <td th:text="${app.ora}"></td>
                    <td th:text="${#strings.equalsIgnoreCase(user.role,'veterinario')} ? ${app.cliente.nome} : ${app.veterinario.nome}"></td>
                    <td th:text="${app.specie}"></td>
                    <td th:text="${app.motivo}"></td>
                    <td th:text="${app.stato}"></td>

                    <td>
                        
                        <div th:if="${#strings.equalsIgnoreCase(user.role,'veterinario')}">
                            <form th:action="@{/dash/appuntamenti/modifica_appuntamento}" method="post">
                                <input type="hidden" name="_method" value="put"/>
                                <input type="hidden" name="id" th:value="${app.id}"/>
                                <button type="submit" class="btn btn-primary">Modifica</button>
                            </form>

                            <form th:action="@{/dash/appuntamenti/elimina_appuntamento}" method="post">
                                <input type="hidden" name="_method" value="delete"/>
                                <input type="hidden" name="id" th:value="${app.id}"/>
                                <button type="submit" class="btn btn-danger">Elimina</button>
                            </form>
                        </div>

                        
                        <div th:if="${#strings.equalsIgnoreCase(user.role,'cliente')}">
                            <form th:action="@{/dash/appuntamenti/elimina_appuntamento}" method="post">
                                <input type="hidden" name="_method" value="delete"/>
                                <input type="hidden" name="id" th:value="${app.id}"/>
                                <button type="submit" class="btn btn-warning">Annulla</button>
                            </form>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>

        <div th:if="${#lists.isEmpty(appuntamenti)}" class="no-data">
            <p>Nessun appuntamento trovato.</p>
        </div>

        <!-- Prenotazione (solo cliente) -->
        <div th:if="${#strings.equalsIgnoreCase(user.role,'cliente')}" class="nuovo-appuntamento">
            <h3>Prenota un nuovo appuntamento</h3>
            <form th:action="@{/lista_veterinari/inserisci_appuntamento}" method="post">
                <label for="veterinario">Veterinario</label>
                <select name="veterinario" id="veterinario" required>
                    <option value="">Seleziona...</option>
                    <option th:each="v : ${veterinariDisponibili}"
                            th:value="${v.id}"
                            th:text="${v.nome}"></option>
                </select>

                <label for="data">Data</label>
                <input type="date" name="data" id="data" required>

                <label for="ora">Ora</label>
                <input type="time" name="ora" id="ora" required>

                <label for="motivo">Motivo</label>
                <textarea name="motivo" id="motivo" rows="3" placeholder="Descrivi il motivo..." required></textarea>

                <button type="submit" class="btn">Prenota</button>
            </form>
        </div>
    </section>
</main>

<footer th:replace="fragments :: footer"></footer>
</body>
</html>
