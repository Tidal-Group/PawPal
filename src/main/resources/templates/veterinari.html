<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<link rel="stylesheet" th:href="@{/css/auth_fragments.css}">
<link rel="stylesheet" th:href="@{/css/veterinari.css}">

<head th:replace="fragments/generic_fragments :: head('Veterinari - Pawpal')"></head>

<body>
    
    <div th:replace="fragments/generic_fragments :: navbar(veterinari)"></div>

    <main>
        <div class="container">
            
            <main>

                <section th:replace="fragments/veterinari_fragments :: ricerca_veterinari"></section>

                <section>
                    <h1>Lista Veterinari</h1>

                    <div class="veterinari-list">
                        <div th:each="vet : ${lista_veterinari}" class="">

                            <!-- <img th:src="@{'/img/' + ${vet.foto}}" alt="Foto di [[${vet.nome}]]"> -->
                            <h3 th:text="${vet.id}"></h3>
                            <h3 th:text="${vet.nome + ' ' + vet.cognome}"></h3>
                            <p th:text="${vet.specializzazione}"></p>
                            <p th:text="${vet.indirizzoStudio}"></p>
                            <button
                                type="button"
                                class="btn btn-secondary showCardVeterinario"
                                th:data-idveterinario="${vet.id}"
                                data-bs-target="#cardVeterinarioModal"
                                data-bs-toggle="modal"
                            >
                                Visualizza Profilo
                            </button>

                            <script>

                                document.addEventListener('DOMContentLoaded', () => {
                                    document.querySelectorAll('.showCardVeterinario').forEach(button => {
                                        
                                        button.addEventListener('click', (event) => {

                                            const idVeterinario = event.currentTarget.dataset.idveterinario;
                                            const modalElement = document.getElementById('cardVeterinarioModal');
                                            
                                            fetch(`/veterinari/lista_veterinari/${idVeterinario}`)
                                            .then(response => {
                                                if (!response.ok) throw new Error(`Failed to fetch profile for ID: ${idVeterinario}. Status: ${response.status}`);
                                                return response.json();
                                            })
                                            .then(data => {
                                                console.log(data)
                                                document.getElementById('registrazioneVeterinarioLabel').textContent = data.nome + " " + data.cognome;
                                                document.getElementById('specializzazione_veterinario').value = data.specializzazione;
                                                document.getElementById('iscrizione_albo_veterinario').value = data.iscrizioneAlbo;
                                                document.getElementById('descrizione_veterinario').value = data.descrizione;
                                                document.getElementById('disponibilita_veterinario').value = data.disponibilita;
                                                document.getElementById('indirizzo_studio_veterinario').value = data.indirizzoStudio;
                                                document.getElementById('telefono_veterinario').value = data.telefono;
                                                document.getElementById('email_veterinario').value = data.email;
                                            })
                                            .catch(error => {
                                                console.error('AJAX Error:', error);
                                                alert("Could not load veterinarian profile.");
                                            });

                                        });
                                    });
                                });

                            </script>

                        </div>
                    </div>

                </section>

            </main>

        </div>
    </main>

    <div th:replace="fragments/veterinari_fragments :: card_veterinario"></div>

    
    <footer th:replace="fragments/generic_fragments :: footer"></footer>

    <!-- <script th:src="@{/js/script.js}"></script> -->
    <div th:replace="fragments/generic_fragments :: show_views_scripts"></div>

</body>
</html>

            <!-- Prenotazione (solo cliente) -->
            <!-- <div th:if="${#authentication.authorities.![authority].contains('ROLE_CLIENTE')}" class="nuovo-appuntamento">
                <h3>Prenota un nuovo appuntamento</h3>
                <form th:action="@{/lista_veterinari/inserisci_appuntamento}" method="post">
                    <label for="veterinario">Veterinario</label>
                    <select name="veterinario" id="veterinario" required>
                        <option value="">Seleziona...</option>
                        <option th:each="v : ${veterinariDisponibili}" th:value="${v.id}" th:text="${v.nome}"></option>
                    </select>

                    <label for="data">Data</label>
                    <input type="date" name="data" id="data" required>

                    <label for="ora">Ora</label>
                    <input type="time" name="ora" id="ora" required>

                    <label for="motivo">Motivo</label>
                    <textarea name="motivo" id="motivo" rows="3" placeholder="Descrivi il motivo..."
                        required></textarea>

                    <button type="submit" class="btn">Prenota</button>
                </form>
            </div> -->